# Centralized Directory Management Guide

This guide outlines the standards for directory and file management in the YTArchive project. A clean, predictable directory structure is essential for organization, debugging, and preventing the repository from becoming cluttered with temporary artifacts.

## 1. The Standard `logs/` Directory Structure

All runtime-generated files, including logs, error reports, and temporary test files, are centralized within the `logs/` directory. This directory is git-ignored and serves as the single location for all operational output.

```
YTArchive/
└── logs/
    ├── temp/                 # Temporary files generated by the test suite
    │   ├── test_abc.tmp
    │   └── test_xyz/
    ├── runtime/              # General runtime logs from all services
    │   └── runtime_log_2025-07-30.jsonl
    ├── failed_downloads/     # Specific logs for downloads that failed
    │   └── failed_download_video123.log
    └── error_reports/        # Detailed error reports from the ErrorRecoveryManager
        └── error_report_uuid.json
```

### Key Directories Explained

*   **`logs/`**: The root for all generated output. This directory should not be committed to version control.
*   **`logs/temp/`**: Exclusively for temporary files and directories created during test runs. This directory is automatically managed and cleaned up by our test utilities.
*   **`logs/runtime/`**, **`logs/failed_downloads/`**, **`logs/error_reports/`**: These are managed by the `LoggingService` and contain the structured logs and reports from all services in the system.

## 2. Managing Temporary Files in Tests

**Problem**: Inconsistent creation of temporary files during testing can lead to artifacts being scattered across the system, stateful tests, and a cluttered repository.

**Solution**: Always use the centralized test utilities provided in `tests/common/temp_utils.py`.

### The `temp_dir` Fixture

This `pytest` fixture is the standard, preferred way to get a temporary directory for a test. It automatically handles creation within `logs/temp/` and ensures cleanup after the test run.

```python
# In any test file
from tests.common.temp_utils import temp_dir

# Pytest will automatically inject the fixture
def test_something_that_needs_a_directory(temp_dir):
    # 'temp_dir' is a pathlib.Path object pointing to a new, empty directory
    # e.g., /path/to/YTArchive/logs/temp/test_g3k4n2b1/
    assert temp_dir.exists()

    # Use it for file operations
    my_file = temp_dir / "test_file.txt"
    my_file.write_text("Hello, world!")

    assert my_file.read_text() == "Hello, world!"

# The directory and its contents will be automatically deleted after the test.
```

### The `CentralizedTempDir` Class

For more complex scenarios where you need more control or need temporary files outside of a `pytest` fixture, you can use the `CentralizedTempDir` class directly.

```python
from tests.common.temp_utils import CentralizedTempDir

manager = CentralizedTempDir()

# Create a directory
temp_dir = manager.create_temp_dir(prefix="my_custom_prefix_")

# Create a file
temp_file = manager.create_temp_file(suffix=".json")

# Manual cleanup if needed (though pytest fixtures handle this automatically)
# manager.cleanup_all()
```

## 3. Managing Service Logs

All services are configured to send their logs to the central `LoggingService`. The `LoggingService` is then responsible for writing these logs to the appropriate files within the `logs/` subdirectories.

*   **Configuration**: Services like `DownloadStateManager` and `BasicErrorReporter` are hard-coded to use paths within the `logs/` directory.
*   **Best Practice**: When creating a new service or a component that needs to write to a file, it should either:
    1.  Send a structured log to the `LoggingService`.
    2.  If it must write its own files, be configured to write them within a subdirectory of `logs/`.

## 4. Best Practices and Rules

1.  **NEVER** write temporary files or logs to the project root or any other source-controlled directory.
2.  **ALWAYS** use the `temp_dir` fixture for temporary directories in tests.
3.  **DO NOT** create your own temporary file logic. Use the provided utilities in `tests/common/temp_utils.py`.
4.  The `logs/` directory **MUST** be included in the `.gitignore` file.
5.  Regularly inspect the `logs/` directory during development to ensure it is being used as expected, but clear it before committing to keep your local environment clean.
